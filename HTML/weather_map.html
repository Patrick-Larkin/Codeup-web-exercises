<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Weather Map</title>

    <!--Bootstrap StyleSheet-->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <!--Weather CSS-->
    <link rel="stylesheet" href="../CSS/weather.css">
    <link rel="stylesheet"
          href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
          type="text/css"/>

    <!--Font Awesome-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css"
          integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous">
</head>


<body>
<!-- jQuery and bootstrap-->
<script src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="
        crossorigin="anonymous"></script>

<!--Keys-->
<script src="../JS/keys.js"></script>

<!-- Mapbox JS -->
<script src='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet'/>

<!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>


<!--Start NavBar-->
<nav class="navbar">
    <div class="nav-logo">
        <h1>Wishful Weather</h1>
        <img src="../Media/IMG/weather.jpg" class="logo" alt="logo">
    </div>
</nav>
<!--End NavBar-->
<div class="cardContainer"></div>
<!--Start Main-->
<main>
    <!--Start 5 Day Forecast-->
    <!--Todo:5 more-->
    <div class="forecastCard">
        <div class="date">
            <p>Content</p>
        </div>
        <div class="temp-and-icon">
            <div id="temperature"></div>
            <i>IMG of current weather</i>
        </div>
        <div class="infoCard">
            <div class="info">
                <div id="description"></div>
            </div>
            <div class="subInfo">
                <div class="rainbox">
                    <div id="rain"></div>
                    <i class="fas fa-cloud-rain fa-2x"></i>
                </div>
                <div class="windBox">
                    <div id="wind"></div>
                    <i class="fas fa-wind fa-2x"></i>
                </div>
            </div>
        </div>
    </div>
    <!--Start 5 Day Forecast-->
</main>
<!--End Main-->

<!-- The HTML element that serves as the Mapbox container -->
<div id='map'></div>


<!--Start Javascript-->
<script>
	$(document).ready(function () {
		//Map
		mapboxgl.accessToken = MAPBOX_TOKEN;
		let map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/streets-v9',
			center: [-98.4935, 29.4264],
			zoom: 10
		});
		map.addControl(
				new MapboxGeocoder({
					accessToken: mapboxgl.accessToken,
					mapboxgl: mapboxgl
				})
		);

		map.on('click', function (e) {
			let location = new mapboxgl.Marker().setLngLat(e.lngLat).addTo(map);
			getCoordinates(e.lngLat);
		});
	})

	let getCoordinates = function (location) {
		let longitude = location.lng;
		let latitude = location.lat;
		getForecast(latitude, longitude);
	}


	//Searchbox attempt fail
	// 	const input = document.getElementById("mapboxgl-ctrl-geocoder--input");
	//
	//
	// 	// Geocode
	// 	geocode(input, MAPBOX_TOKEN).then(function (results) {
	// 		console.log(results)
	// 	})
	//
	// // Basic Function Geocode.
	// function geocode(input, MAPBOX_TOKEN) {
	// 	var baseUrl = 'https://api.mapbox.com';
	// 	var endPoint = '/geocoding/v5/mapbox.places/';
	// 	return fetch(baseUrl + endPoint + encodeURIComponent(input) + '.json' + "?" + 'access_token=' + MAPBOX_TOKEN)
	// 			.then(function (res) {
	// 				return res.json();
	// 				// to get all the data from the request, comment out the following three lines...
	// 			}).then(function (data) {
	// 				return data.features[0].center;
	// 			});
	// }


	// if box selected = true = imperial, else = imperial
	let getForecast = function (latitude, longitude) {
		$.get("https://api.openweathermap.org/data/2.5/onecall", {
			APPID: OPEN_WEATHER_MAP_KEY,
			lat: latitude,
			lon: longitude,
			exclude: "hourly, minutely",
			units: "imperial"
		}).done(function (data) {
			console.log(data)
			presentForecast(data)
			futureForecast(data)
		}).error(function () {
			alert('error retrieving forecast');
		})
	}

	// Single iteration card
	let presentForecast = function (data, i = 0) {
		// Did dt ever work whats the value log it
		let dt = '<h1>' + data.daily[i].dt + '</h1>';
		$('#card').append(dt);

		let tempHTML = '<h3>' + data.daily[i].temp.min + '째f | ' + data.daily[i].temp.max + '째f' + '</h3>';
		$('#temperature').html(tempHTML);

		let descriptionHTML = '<h4>' + 'Description: ' + data.daily[i].weather[0].description + '</h4>';
		$('#description').html(descriptionHTML);

		let windHTML = '<h4>' + data.daily[i].wind_speed + 'mp/h' + '</h4>';
		$('#wind').html(windHTML);

		let popHTML = '<h4>' + data.daily[i].pop + '%' + '</h4>';
		$('#rain').html(popHTML);
	}

	// let futureForecast = function (data) {
	// 	var card = $('cardContainer')
	// 	data.daily.forEach(function (i) {
	// 		card.append('<h3>' + 'AAAAAAAAA' + '</h3>')
	// 	})
	// }


	// Future iteration card attempt #5
	let futureForecast = function (data) {
			// 	// Did dt ever work whats the value log it
			// 	// let dt = '<h1>' + data.daily[i].dt + '</h1>';
			// 	// $('#card').append(dt);
                for (let i = 0; i < data.daily.length; i++) {
                	const createCard = document.createElement('div')

				$("#cardContainer").append('<h3>' + data.daily[i].temp.min + '째f | ' + data.daily[i].temp.max + '째f' + '</h3>');
				$("#cardContainer").append('<h4>' + 'Description: ' + data.daily[i].weather[0].description + '</h4>');
				$("#cardContainer").append('<h4>' + data.daily[i].wind_speed + 'mp/h' + '</h4>');
				$("#cardContainer").append('<h4>' + data.daily[i].pop + '%' + '</h4>');
			}
		}

	// })
    // }


	// Experimental #2
	// data.daily.forEach(function (i) {
	// let cardContent ='<div class="card">' + '<div id="description"></div>' + '<div id="humidity"></div>' + '<div id="wind"></div>' + '<div id="pressure"></div>' + '</div>';
	// $('#cardContainer').append(cardContent);
	// })
	// End Loop
</script>


<!--TODO:Add a Mapbox text input to search by location and have the forecast update when a new location is searched.-->

<!--TODO:As a bonus make sure you can update the marker's position to the new search result.-->
</body>
<!--Start Javascript-->

</html>



<!--Importante-->
<!--let items = ['apple', 'grape', 'orange'];-->
<!--//-->
<!--let itemsHtml = `-->
<!--<ul>-->
<!--    <li>${items[0]}</li>-->
<!--    <li>${items[1]}</li>-->
<!--    <li>${items[2]}</li>-->
<!--</ul>-->
<!--`;-->

<!--console.log(itemsHtml);-->
<!--document.write(itemsHtml);-->